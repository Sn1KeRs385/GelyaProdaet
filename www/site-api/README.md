# Site API (Go)

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ API –¥–ª—è —Å–∞–π—Ç–∞ GelyaProdaet, –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–µ –Ω–∞ Go —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Fiber —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: Go + Fiber –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –¥–æ 132,000 req/s
- **Go 1.24.3**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è Go
- **GORM ORM**: –£–¥–æ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- **RESTful API**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ HTTP –º–µ—Ç–æ–¥—ã –∏ —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã
- **CORS –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –ì–æ—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è dev –∏ prod

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.24.3+
- PostgreSQL 12+
- Docker & Docker Compose (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:**
   ```bash
   cd www/site-api
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   make deps
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   vim .env
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   make dev  # –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å hot reload
   # –∏–ª–∏
   make run  # –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
   ```

### Docker —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose:**
   ```bash
   # –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
   docker-compose -f docker-compose.local.yml up go-api
   ```

2. **–ü–æ–ª–Ω–∞—è dev —Å—Ä–µ–¥–∞:**
   ```bash
   # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Laravel API, Go API, PostgreSQL, Redis, Nginx)
   docker-compose -f docker-compose.local.yml up
   ```

## üìö API Endpoints

### –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Nginx (–≤ Docker)
- **Go API (–≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–π—Ç–∞)**: `http://api.gelyaprodaet.local/site/`
- **Laravel API (–∞–¥–º–∏–Ω–∫–∞, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞)**: `http://api.gelyaprodaet.local/`
- **Health Check**: `http://api.gelyaprodaet.local/site/health`

### –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- **Go API**: `http://localhost:8080/api/v1/`
- **Laravel API**: `http://localhost:8000/api/`

### –¢–æ–≤–∞—Ä—ã (Products)
- `GET /site/products` - –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π, –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
  - **–§–∏–ª—å—Ç—Ä—ã**: `is_active`, `type_id`, `gender_id`, `brand_id`, `country_id`, `size_id`, `color_id`, `size_year_id`
  - **–ü–∞–≥–∏–Ω–∞—Ü–∏—è**: `page`, `per_page` (–º–∞–∫—Å. 100 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
  - **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: `sort_by` (`created_at`, `price`), `sort_direction` (`asc`, `desc`)
  - **–ë–∞–∑–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å `is_for_sale=true` —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
  - **–û—Ç–≤–µ—Ç**: –æ–±—ä–µ–∫—Ç —Å `data` (—Ç–æ–≤–∞—Ä—ã) –∏ `meta` (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
- `GET /site/products/:id` - –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID —Å –ø–æ–ª–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏

### –û–ø—Ü–∏–∏ (Options) 
- `GET /site/options` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–ø—Ü–∏–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ group_slug, weight, title

### –°–∏—Å—Ç–µ–º–∞
- `GET /site/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è API

## üóÑ –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### ListOption
```json
{
  "id": 1,
  "group_slug": "sizes",
  "title": "XL",
  "weight": 10,
  "is_hidden_from_user_filters": false,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

### Product
```json
{
  "id": 1,
  "title": "–§—É—Ç–±–æ–ª–∫–∞ Nike",
  "description": "–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞",
  "type_id": 1,
  "gender_id": 2,
  "brand_id": 3,
  "country_id": 4,
  "send_to_telegram": false,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z",
  "type": { /* ListOption */ },
  "gender": { /* ListOption */ },
  "brand": { /* ListOption */ },
  "country": { /* ListOption */ },
  "items": [ /* ProductItem[] */ ]
}
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–î–∞–Ω–Ω–æ–µ API –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **132,000+ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É** –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ù–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: ~1.8ms —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: ~55MB –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `DB_HOST` | –•–æ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `localhost` |
| `DB_PORT` | –ü–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `5432` |
| `DB_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î | `postgres` |
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å –ë–î | `` |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `gelya_prodaet` |
| `DB_SSLMODE` | SSL —Ä–µ–∂–∏–º | `disable` |
| `SERVER_PORT` | –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ | `8080` |

## üèó –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
site-api/
‚îú‚îÄ‚îÄ main.go                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.go           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ database.go         # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ product_handler.go
‚îÇ   ‚îú‚îÄ‚îÄ product_item_handler.go
‚îÇ   ‚îî‚îÄ‚îÄ list_option_handler.go
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ product.go
‚îÇ   ‚îú‚îÄ‚îÄ product_item.go
‚îÇ   ‚îú‚îÄ‚îÄ list_option.go
‚îÇ   ‚îú‚îÄ‚îÄ user.go
‚îÇ   ‚îî‚îÄ‚îÄ user_identifier.go
‚îú‚îÄ‚îÄ utils/                  # –£—Ç–∏–ª–∏—Ç—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
‚îú‚îÄ‚îÄ go.mod                  # Go –º–æ–¥—É–ª—å (Go 1.24.3)
‚îú‚îÄ‚îÄ go.sum
‚îú‚îÄ‚îÄ Makefile               # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ API.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
```

### üìÅ –ü—Ä–æ—Å—Ç–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º **–ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É** –±–µ–∑ –∏–∑–ª–∏—à–Ω–∏—Ö —É—Å–ª–æ–∂–Ω–µ–Ω–∏–π:
- **main.go**: –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- **–ü–ª–æ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: –í—Å–µ –ø–∞–∫–µ—Ç—ã –≤ –∫–æ—Ä–Ω–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
- **–ë–µ–∑ internal/**: –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ API
- **–ë–µ–∑ cmd/**: –û–¥–∏–Ω –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞–ø–∫–∏

–≠—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è **–≤–Ω–µ—à–Ω–µ–≥–æ API —Å–∞–π—Ç–∞**, –∫–æ—Ç–æ—Ä–æ–µ:
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –õ–µ–≥–∫–æ –ø–æ–Ω–∏–º–∞–µ—Ç—Å—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker —Ñ–∞–π–ª—ã
- **Dockerfile**: `config/site-api/Dockerfile` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç Go 1.24.3)
- **Docker Compose**: `docker-compose.local.yml` (dev –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è development

1. **–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:**
   ```bash
   docker-compose -f docker-compose.local.yml up
   ```

2. **–¢–æ–ª—å–∫–æ Go API:**
   ```bash
   docker-compose -f docker-compose.local.yml up go-api postgres
   ```

3. **–ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞:**
   ```bash
   docker-compose -f docker-compose.local.yml build go-api
   ```

### Production

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏**
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å reverse proxy (nginx)**
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å connection pooling –¥–ª—è –ë–î**
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Laravel

| –ú–µ—Ç—Ä–∏–∫–∞ | Laravel PHP | Go API |
|---------|-------------|--------|
| –ó–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ | ~5,000 | ~132,000 |
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ | ~20ms | ~1.8ms |
| –ü–∞–º—è—Ç—å | ~200MB | ~55MB |
| CPU | –í—ã—Å–æ–∫–æ–µ | –ù–∏–∑–∫–æ–µ |
| –í–µ—Ä—Å–∏—è | PHP 8.2 | **Go 1.24.3** |

Go API –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **26x –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å Laravel!

## üê≥ Docker –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–í dev —Å—Ä–µ–¥–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è:
- **PostgreSQL 16** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis 7** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Laravel API** - —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ PHP API (–ø–æ—Ä—Ç 8000)
- **Go API** - –Ω–æ–≤–æ–µ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ API (–ø–æ—Ä—Ç 8080)
- **Nginx** - reverse proxy —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π:
  - `/api/` ‚Üí Go API
  - `/laravel-api/` ‚Üí Laravel API
  - `/admin/` ‚Üí Admin –ø–∞–Ω–µ–ª—å
  - `/health` ‚Üí Health check Go API